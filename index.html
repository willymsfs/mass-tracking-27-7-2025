<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mass Intentions Management System - MSFS Enhanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --error-color: #e74c3c;
            --info-color: #3498db;
            --dark-bg: #2c3e50;
            --light-bg: #ecf0f1;
            --card-shadow: 0 10px 30px rgba(0,0,0,0.1);
            --hover-shadow: 0 15px 40px rgba(0,0,0,0.15);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }
        
        /* Animated background particles */
        .bg-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .header h1 {
            font-size: clamp(1.8rem, 4vw, 2.8rem);
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            font-weight: 800;
            letter-spacing: -1px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.2rem;
            font-weight: 500;
        }
        
        .main-nav {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
            position: sticky;
            top: 20px;
            z-index: 100;
        }
        
        .nav-btn {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: none;
            padding: 16px 28px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: var(--hover-shadow);
            background: rgba(255, 255, 255, 1);
        }
        
        .nav-btn.active {
            background: var(--primary-gradient);
            color: white;
            transform: translateY(-3px);
        }
        
        .nav-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            transition: var(--transition);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        
        .nav-btn:hover::after {
            width: 300px;
            height: 300px;
        }
        
        .page {
            display: none;
            animation: pageEnter 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes pageEnter {
            from { 
                opacity: 0; 
                transform: translateY(30px) scale(0.95);
                filter: blur(10px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1);
                filter: blur(0);
            }
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-10px);
            box-shadow: var(--hover-shadow);
        }
        
        .card:hover::before {
            transform: scaleX(1);
        }
        
        .card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
        }
        
        .card-icon {
            font-size: 2rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-number {
            font-size: 3rem;
            font-weight: 900;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 15px 0;
            line-height: 1;
        }
        
        .progress-container {
            margin: 20px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 25px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--primary-gradient);
            border-radius: 25px;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: progressShimmer 2s infinite;
        }
        
        @keyframes progressShimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .quick-stat {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .quick-stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--info-color);
        }
        
        .quick-stat-label {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .table-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 30px;
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            margin-top: 20px;
        }
        
        .data-table th {
            background: var(--primary-gradient);
            color: white;
            padding: 18px 15px;
            text-align: center;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            border: none;
        }
        
        .data-table td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.5);
        }
        
        .data-table tr:hover td {
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.01);
        }
        
        .data-table tr:nth-child(even) td {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            background: var(--primary-gradient);
            color: white;
            position: relative;
            overflow: hidden;
            margin: 5px;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: var(--transition);
            transform: translate(-50%, -50%);
        }
        
        .btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .btn-success { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .btn-warning { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .btn-danger { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .btn-info { background: linear-gradient(135deg, #3498db, #2980b9); }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            margin: 3% auto;
            padding: 40px;
            border-radius: 25px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.7) translateY(-50px);
                filter: blur(10px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
                filter: blur(0);
            }
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 15px;
            font-size: 14px;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }
        
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 20px 25px;
            border-radius: 15px;
            color: white;
            font-weight: 600;
            z-index: 3000;
            transform: translateX(400px);
            transition: var(--transition);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .notification.error { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .notification.info { background: linear-gradient(135deg, #3498db, #2980b9); }
        .notification.warning { background: linear-gradient(135deg, #f39c12, #e67e22); }
        
        .breadcrumb {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 15px 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
            cursor: pointer;
        }
        
        .breadcrumb a:hover {
            color: #764ba2;
            transform: scale(1.05);
        }
        
        .year-selector {
            margin-bottom: 30px;
        }
        
        .year-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }
        
        .year-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(102, 126, 234, 0.2);
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            transition: var(--transition);
        }
        
        .year-btn:hover, .year-btn.active {
            background: var(--primary-gradient);
            color: white;
            border-color: #667eea;
            transform: scale(1.05);
        }
        
        .month-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .month-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .month-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: var(--hover-shadow);
        }
        
        .month-card h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
            font-weight: 700;
        }
        
        .month-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header {
                padding: 25px;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .main-nav {
                flex-direction: column;
                align-items: center;
                position: static;
            }
            
            .nav-btn {
                width: 200px;
                justify-content: center;
            }
            
            .table-header {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <!-- Animated background particles -->
    <div class="bg-particles" id="particles"></div>

    <!-- Notification element -->
    <div id="notification" class="notification"></div>

    <div class="container">
        <!-- Enhanced Header -->
        <div class="header">
            <h1>🕊️ Mass Intentions Management System</h1>
            <p>Missionaries of St. Francis de Sales (MSFS) - Enhanced Digital Register</p>
        </div>

        <!-- Enhanced Navigation -->
        <div class="main-nav">
            <button class="nav-btn active" onclick="showPage(event, 'dashboard')">
                <span>🏠</span> Dashboard
            </button>
            <button class="nav-btn" onclick="showPage(event, 'calendar')">
                <span>📅</span> Calendar
            </button>
            <button class="nav-btn" onclick="showPage(event, 'deceased')">
                <span>🙏</span> Deceased
            </button>
            <button class="nav-btn" onclick="showPage(event, 'personal')">
                <span>💒</span> Personal
            </button>
            <button class="nav-btn" onclick="showPage(event, 'analytics')">
                <span>📊</span> Analytics
            </button>
            <button class="nav-btn" onclick="showPage(event, 'reports')">
                <span>📈</span> Reports
            </button>
            <button class="nav-btn" onclick="showPage(event, 'settings')">
                <span>⚙️</span> Settings
            </button>
        </div>

        <!-- Enhanced Dashboard -->
        <div id="dashboard" class="page active">
            <div class="dashboard-grid">
                <div class="card">
                    <h3><span class="card-icon">📈</span>Mass Statistics</h3>
                    <div class="stat-number" id="totalMasses">278</div>
                    <p>Total Masses Celebrated</p>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 92.7%"></div>
                        </div>
                        <small>92.7% of 300 intentions completed</small>
                    </div>
                </div>
                
                <div class="card">
                    <h3><span class="card-icon">🔢</span>Serial Progress</h3>
                    <div class="stat-number" id="remainingSerial">22</div>
                    <p>Serial Numbers Remaining</p>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 92.7%"></div>
                        </div>
                        <small>278 of 300 completed</small>
                    </div>
                </div>
                
                <div class="card">
                    <h3><span class="card-icon">⚠️</span>Missed Masses</h3>
                    <div class="stat-number" id="missedMasses">33</div>
                    <p>Masses Not Celebrated</p>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 10.6%; background: var(--error-color);"></div>
                        </div>
                        <small>10.6% of total period</small>
                    </div>
                </div>
                
                <div class="card">
                    <h3><span class="card-icon">🕊️</span>Memorial Masses</h3>
                    <div class="stat-number" id="deceasedMasses">18</div>
                    <p>Deceased Confreres</p>
                    <div class="quick-stats">
                        <div class="quick-stat">
                            <div class="quick-stat-number">18</div>
                            <div class="quick-stat-label">Completed</div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-number">0</div>
                            <div class="quick-stat-label">Pending</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3><span class="card-icon">💒</span>Personal Masses</h3>
                    <div class="stat-number" id="personalMasses">36</div>
                    <p>Personal Intentions</p>
                    <div class="quick-stats">
                        <div class="quick-stat">
                            <div class="quick-stat-number">3</div>
                            <div class="quick-stat-label">Per Month</div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-number">12</div>
                            <div class="quick-stat-label">Months</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3><span class="card-icon">📅</span>Current Period</h3>
                    <div style="font-size: 1.3rem; font-weight: bold; background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 15px 0;">
                        Aug 2023 - Jun 2024
                    </div>
                    <p>312 days coverage</p>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 100%"></div>
                        </div>
                        <small>Period completed successfully</small>
                    </div>
                </div>
            </div>
            
            <!-- Enhanced Quick Actions -->
            <div class="card">
                <h3><span class="card-icon">🚀</span>Quick Actions</h3>
                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px;">
                    <button class="btn" onclick="showAddMassModal()">
                        <span>➕</span> Add New Mass
                    </button>
                    <button class="btn btn-info" onclick="showPage(event, 'calendar')">
                        <span>📅</span> View Calendar
                    </button>
                    <button class="btn btn-success" onclick="exportData('csv')">
                        <span>📊</span> Export Data
                    </button>
                    <button class="btn btn-warning" onclick="showPage(event, 'reports')">
                        <span>📈</span> Generate Report
                    </button>
                </div>
            </div>
        </div>

        <!-- Calendar View Page -->
        <div id="calendar" class="page">
            <div class="breadcrumb">
                <a onclick="showPage(event, 'dashboard')">🏠 Dashboard</a> / 📅 Calendar View
            </div>
            
            <div class="card year-selector">
                <h3 style="text-align: center; margin-bottom: 20px;">Select Year & Month</h3>
                <div class="year-buttons">
                    <button class="year-btn" onclick="selectYear(event, 2020)">2020</button>
                    <button class="year-btn" onclick="selectYear(event, 2021)">2021</button>
                    <button class="year-btn" onclick="selectYear(event, 2022)">2022</button>
                    <button class="year-btn" onclick="selectYear(event, 2023)">2023</button>
                    <button class="year-btn active" onclick="selectYear(event, 2024)">2024</button>
                    <button class="year-btn" onclick="selectYear(event, 2025)">2025</button>
                </div>
                
                <div class="month-grid" id="monthGrid">
                    <!-- Months will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Month View Table -->
            <div class="table-container" id="monthTable" style="display: none;">
                <div class="table-header">
                    <h3 id="monthTitle">January 2024</h3>
                    <div>
                        <button class="btn" onclick="showAddMassModal()">➕ Add Mass</button>
                        <button class="btn btn-success" onclick="saveMonthData()">💾 Save Changes</button>
                        <button class="btn btn-danger" onclick="hideMonthTable()">❌ Close</button>
                    </div>
                </div>
                
                <table class="data-table" id="massTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Serial No.</th>
                            <th>Date of Receipt</th>
                            <th>From Whom</th>
                            <th>Intentions</th>
                            <th>Remarks</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="massTableBody">
                        <!-- Data will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Deceased Confreres Page -->
        <div id="deceased" class="page">
            <div class="breadcrumb">
                <a onclick="showPage(event, 'dashboard')">🏠 Dashboard</a> / 🙏 Deceased Confreres
            </div>
            
            <div class="table-container">
                <div class="table-header">
                    <h3>🙏 Masses for Deceased MSFS Confreres</h3>
                    <button class="btn" onclick="showAddDeceasedModal()">➕ Add Deceased Confrere</button>
                </div>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Receipt Date</th>
                            <th>Death Date</th>
                            <th>Name of Deceased</th>
                            <th>When Celebrated</th>
                            <th>Province</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="deceasedTableBody">
                        <!-- Data populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Personal Masses Page -->
        <div id="personal" class="page">
            <div class="breadcrumb">
                <a onclick="showPage(event, 'dashboard')">🏠 Dashboard</a> / 💒 Personal Masses
            </div>
            
            <div class="table-container">
                <div class="table-header">
                    <h3>💒 Monthly Personal Mass Intentions</h3>
                    <button class="btn" onclick="showAddPersonalModal()">➕ Add Personal Mass</button>
                </div>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Mass I Date</th>
                            <th>Mass II Date</th>
                            <th>Mass III Date</th>
                            <th>Remarks</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="personalTableBody">
                        <!-- Data populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Analytics Page -->
        <div id="analytics" class="page">
            <div class="breadcrumb">
                <a onclick="showPage(event, 'dashboard')">🏠 Dashboard</a> / 📊 Analytics
            </div>
            
            <div class="dashboard-grid">
                <div class="card">
                    <h3><span class="card-icon">📊</span>Monthly Trends</h3>
                    <p>Mass celebration patterns throughout the year</p>
                    <div id="monthlyChart" style="height: 200px; display: flex; align-items: center; justify-content: center; color: #7f8c8d;">
                        Chart visualization would go here
                    </div>
                </div>
                
                <div class="card">
                    <h3><span class="card-icon">🎯</span>Completion Rate</h3>
                    <p>Track your progress over time</p>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 92.7%"></div>
                        </div>
                        <small>92.7% completion rate</small>
                    </div>
                </div>
                
                <div class="card">
                    <h3><span class="card-icon">📈</span>Mass Types</h3>
                    <div class="quick-stats">
                        <div class="quick-stat">
                            <div class="quick-stat-number">278</div>
                            <div class="quick-stat-label">Serial</div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-number">36</div>
                            <div class="quick-stat-label">Personal</div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-number">18</div>
                            <div class="quick-stat-label">Deceased</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports & Export Page -->
        <div id="reports" class="page">
            <div class="breadcrumb">
                <a onclick="showPage(event, 'dashboard')">🏠 Dashboard</a> / 📈 Reports & Export
            </div>
            
            <div class="dashboard-grid">
                <div class="card">
                    <h3><span class="card-icon">📋</span>Export Options</h3>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px;">
                        <button class="btn" onclick="exportData('csv')">
                            📊 Export CSV
                        </button>
                        <button class="btn btn-success" onclick="exportData('excel')">
                            📗 Export Excel
                        </button>
                        <button class="btn btn-info" onclick="exportData('pdf')">
                            📄 Export PDF
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <h3><span class="card-icon">📈</span>Quick Reports</h3>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px;">
                        <button class="btn btn-warning" onclick="generateReport('summary')">
                            📊 Summary Report
                        </button>
                        <button class="btn btn-info" onclick="generateReport('monthly')">
                            📅 Monthly Report
                        </button>
                        <button class="btn" onclick="generateReport('deceased')">
                            🙏 Deceased Report
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings" class="page">
            <div class="breadcrumb">
                <a onclick="showPage(event, 'dashboard')">🏠 Dashboard</a> / ⚙️ Settings
            </div>
            
            <!-- Bulk Import Section -->
            <div class="card">
                <h3><span class="card-icon">📥</span>Bulk Data Import</h3>
                <p style="color: #7f8c8d; margin-bottom: 20px;">Import large datasets from CSV, Excel, or JSON files. Perfect for migrating historical data or bulk updates.</p>
                
                <div class="form-group">
                    <label>Select Import File</label>
                    <input type="file" id="importFile" accept=".csv,.xlsx,.xls,.json" onchange="handleFileSelect(event)" style="margin-bottom: 15px;">
                    <small style="color: #7f8c8d;">Supported formats: CSV (.csv), Excel (.xlsx, .xls), JSON (.json)</small>
                </div>
                
                <div class="form-group">
                    <label>Import Type</label>
                    <select id="importType">
                        <option value="mass">Mass Entries</option>
                        <option value="deceased">Deceased Confreres</option>
                        <option value="personal">Personal Masses</option>
                        <option value="complete">Complete Database</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Import Mode</label>
                    <select id="importMode">
                        <option value="merge">Merge with existing data</option>
                        <option value="replace">Replace existing data</option>
                        <option value="append">Append to existing data</option>
                    </select>
                </div>
                
                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px;">
                    <button class="btn" onclick="showImportPreview()">👁️ Preview Data</button>
                    <button class="btn btn-success" onclick="executeImport()" id="importBtn" disabled>📥 Import Data</button>
                    <button class="btn btn-info" onclick="downloadTemplate()">📋 Download Template</button>
                    <button class="btn btn-warning" onclick="showImportHelp()">❓ Import Help</button>
                </div>
                
                <!-- Import Preview -->
                <div id="importPreview" style="display: none; margin-top: 25px;">
                    <h4>📋 Import Preview</h4>
                    <div id="previewContent" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 10px; padding: 15px; background: #f8f9fa;">
                        <!-- Preview content will be populated here -->
                    </div>
                    <div style="margin-top: 15px;">
                        <span id="previewStats" style="color: #7f8c8d;"></span>
                    </div>
                </div>
            </div>
            
            <!-- System Settings -->
            <div class="card">
                <h3><span class="card-icon">⚙️</span>System Settings</h3>
                <div class="form-group">
                    <label>Current Period</label>
                    <input type="text" id="currentPeriod" value="August 23, 2023 - June 29, 2024" readonly>
                </div>
                <div class="form-group">
                    <label>Total Mass Intentions Received</label>
                    <input type="number" id="totalIntentions" value="300">
                </div>
                <div class="form-group">
                    <label>Auto-backup Frequency</label>
                    <select id="backupFreq">
                        <option value="daily">Daily</option>
                        <option value="weekly" selected>Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>
                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px;">
                    <button class="btn btn-success" onclick="saveSettings()">💾 Save Settings</button>
                    <button class="btn btn-info" onclick="backupData()">🔄 Backup Data</button>
                    <button class="btn btn-danger" onclick="resetData()">🗑️ Reset All Data</button>
                </div>
            </div>
        </div>

        <!-- Add Mass Modal -->
        <div id="addMassModal" class="modal">
            <div class="modal-content">
                <h3>➕ Add New Mass Entry</h3>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="massDate" required>
                </div>
                <div class="form-group">
                    <label>Serial Number</label>
                    <input type="text" id="massSerial" placeholder="Leave empty for non-serial masses">
                </div>
                <div class="form-group">
                    <label>Date of Receipt</label>
                    <input type="date" id="massReceiptDate">
                </div>
                <div class="form-group">
                    <label>From Whom</label>
                    <select id="massFrom">
                        <option value="Provincial">Provincial</option>
                        <option value="Generalate">Generalate</option>
                        <option value="Personal">Personal</option>
                        <option value="MSFS">MSFS (Deceased)</option>
                        <option value="Special">Special</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Intentions</label>
                    <input type="text" id="massIntentions" placeholder="Mass intention details" required>
                </div>
                <div class="form-group">
                    <label>Remarks</label>
                    <textarea id="massRemarks" rows="3" placeholder="Additional remarks"></textarea>
                </div>
                <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 20px;">
                    <button class="btn btn-success" onclick="saveMass()">💾 Save Mass</button>
                    <button class="btn btn-danger" onclick="closeModal('addMassModal')">❌ Cancel</button>
                </div>
            </div>
        </div>

        <!-- Add Deceased Modal -->
        <div id="addDeceasedModal" class="modal">
            <div class="modal-content">
                <h3>🙏 Add Deceased Confrere</h3>
                <div class="form-group">
                    <label>Receipt Date</label>
                    <input type="date" id="deceasedReceiptDate" required>
                </div>
                <div class="form-group">
                    <label>Death Date</label>
                    <input type="date" id="deceasedDeathDate" required>
                </div>
                <div class="form-group">
                    <label>Name of Deceased</label>
                    <input type="text" id="deceasedName" placeholder="Fr./Bro. Name - Province" required>
                </div>
                <div class="form-group">
                    <label>When Celebrated</label>
                    <input type="date" id="deceasedCelebrated" required>
                </div>
                <div class="form-group">
                    <label>Province</label>
                    <input type="text" id="deceasedProvince" placeholder="Province name">
                </div>
                <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 20px;">
                    <button class="btn btn-success" onclick="saveDeceased()">💾 Save Entry</button>
                    <button class="btn btn-danger" onclick="closeModal('addDeceasedModal')">❌ Cancel</button>
                </div>
            </div>
        </div>

        <!-- Add Personal Mass Modal -->
        <div id="addPersonalModal" class="modal">
            <div class="modal-content">
                <h3>💒 Add Personal Mass</h3>
                <div class="form-group">
                    <label>Month</label>
                    <select id="personalMonth" required>
                        <option value="">Select Month</option>
                        <option value="January">January</option>
                        <option value="February">February</option>
                        <option value="March">March</option>
                        <option value="April">April</option>
                        <option value="May">May</option>
                        <option value="June">June</option>
                        <option value="July">July</option>
                        <option value="August">August</option>
                        <option value="September">September</option>
                        <option value="October">October</option>
                        <option value="November">November</option>
                        <option value="December">December</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Year</label>
                    <input type="number" id="personalYear" value="2024" min="2020" max="2030" required>
                </div>
                <div class="form-group">
                    <label>Mass I Date</label>
                    <input type="number" id="personalMass1" min="1" max="31">
                </div>
                <div class="form-group">
                    <label>Mass II Date</label>
                    <input type="number" id="personalMass2" min="1" max="31">
                </div>
                <div class="form-group">
                    <label>Mass III Date</label>
                    <input type="number" id="personalMass3" min="1" max="31">
                </div>
                <div class="form-group">
                    <label>Remarks</label>
                    <textarea id="personalRemarks" rows="3" placeholder="Special intentions, birthdays, etc."></textarea>
                </div>
                <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 20px;">
                    <button class="btn btn-success" onclick="savePersonalMass()">💾 Save Entry</button>
                    <button class="btn btn-danger" onclick="closeModal('addPersonalModal')">❌ Cancel</button>
                </div>
            </div>
        </div>

        <!-- Import Help Modal -->
        <div id="importHelpModal" class="modal">
            <div class="modal-content" style="max-width: 800px;">
                <h3>📋 Bulk Import Help & Templates</h3>
                
                <div style="margin-bottom: 25px;">
                    <h4>📊 Mass Entries CSV Format:</h4>
                    <pre style="background: #f8f9fa; padding: 15px; border-radius: 10px; font-size: 12px; overflow-x: auto;">
Year,Month,Date,SerialNo,ReceiptDate,FromWhom,Intentions,Remarks,Type
2024,1,1,147,2023-08-23,Provincial,"Mass Intention","","regular"
2024,1,13,"",2024-01-12,MSFS,"Fr. Mariadas Sesetti","Deceased Confrere","deceased"
2024,1,18,"","",Personal,"Gladwin's Birthday Mass","Personal Intention","personal"
2024,2,16,"","",Personal,"Dominic's Birthday Mass","Personal Intention","personal"</pre>
                </div>
                
                <div style="margin-bottom: 25px;">
                    <h4>🙏 Deceased Confreres CSV Format:</h4>
                    <pre style="background: #f8f9fa; padding: 15px; border-radius: 10px; font-size: 12px; overflow-x: auto;">
ReceiptDate,DeathDate,Name,CelebratedDate,Province
2024-01-12,2024-01-12,"Fr. Mariadas Sesetti",2024-01-13,"Vizag Province"
2024-02-14,2024-02-14,"Fr. Joseph Charles Pednekar",2024-02-15,"Goa Province"</pre>
                </div>
                
                <div style="margin-bottom: 25px;">
                    <h4>💒 Personal Masses CSV Format:</h4>
                    <pre style="background: #f8f9fa; padding: 15px; border-radius: 10px; font-size: 12px; overflow-x: auto;">
Month,Year,Mass1,Mass2,Mass3,Remarks
January,2024,18,27,5,"Gladwin's Birthday; Anniversary; Personal"
February,2024,16,27,10,"Dominic's Birthday; Personal; Personal"</pre>
                </div>
                
                <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 20px;">
                    <button class="btn" onclick="downloadAllTemplates()">📥 Download All Templates</button>
                    <button class="btn btn-danger" onclick="closeModal('importHelpModal')">❌ Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global data storage
        let massData = {};
        let deceasedData = [];
        let personalData = [];
        let currentYear = 2024;
        let currentMonth = null;
        let importPreviewData = null;

        // Initialize data with sample entries
        function initializeData() {
            // Sample mass data for 2024
            massData = {
                2024: {
                    1: [ // January
                        {id: 1, date: 1, serial: 147, receiptDate: '2023-08-23', from: 'Provincial', intentions: 'Mass Intention', remarks: '', type: 'regular'},
                        {id: 2, date: 13, serial: '', receiptDate: '2024-01-12', from: 'MSFS', intentions: 'Fr. Mariadas Sesetti', remarks: 'Deceased Confrere', type: 'deceased'},
                        {id: 3, date: 18, serial: '', receiptDate: '', from: 'Personal', intentions: "Gladwin's Birthday Mass", remarks: 'Personal Intention', type: 'personal'},
                        {id: 4, date: 24, serial: '', receiptDate: '', from: 'Special', intentions: 'SFS Feast Day', remarks: 'SFS Feast Day mass celebrated', type: 'special'},
                    ],
                    2: [ // February
                        {id: 20, date: 16, serial: '', receiptDate: '', from: 'Personal', intentions: "Dominic's Birthday Mass", remarks: 'Personal Intention', type: 'personal'},
                    ],
                }
            };

            // Sample deceased data
            deceasedData = [
                {id: 1, receiptDate: '2024-01-12', deathDate: '2024-01-12', name: 'Fr. Mariadas Sesetti', celebrated: '2024-01-13', province: 'Vizag Province'},
                {id: 2, receiptDate: '2024-02-14', deathDate: '2024-02-14', name: 'Fr. Joseph Charles Pednekar', celebrated: '2024-02-15', province: 'Goa Province'},
            ];

            // Sample personal mass data
            personalData = [
                {id: 1, month: 'January', year: 2024, mass1: 18, mass2: 27, mass3: 5, remarks: "Gladwin's Birthday; Ordination Anniversary; Personal"},
                {id: 2, month: 'February', year: 2024, mass1: 16, mass2: 27, mass3: 10, remarks: "Dominic's Birthday; Personal; Personal"},
            ];

            // Load from memory storage if available (not localStorage for Claude.ai compatibility)
            if (window.massIntentionsStorage) {
                massData = window.massIntentionsStorage.massData || massData;
                deceasedData = window.massIntentionsStorage.deceasedData || deceasedData;
                personalData = window.massIntentionsStorage.personalData || personalData;
            }
        }

        // Save data to memory storage
        function saveToStorage() {
            if (!window.massIntentionsStorage) {
                window.massIntentionsStorage = {};
            }
            window.massIntentionsStorage.massData = massData;
            window.massIntentionsStorage.deceasedData = deceasedData;
            window.massIntentionsStorage.personalData = personalData;
            showNotification('Data saved successfully!', 'success');
        }

        // Page navigation - Fixed function signature
        function showPage(event, pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });

            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected page
            document.getElementById(pageId).classList.add('active');

            // Add active class to clicked nav button
            if (event && event.target) {
                event.target.classList.add('active');
            }

            // Load data for specific pages
            if (pageId === 'deceased') loadDeceasedData();
            if (pageId === 'personal') loadPersonalData();
            if (pageId === 'calendar') updateMonthGrid(currentYear);
        }

        // Year selection - Fixed function signature
        function selectYear(event, year) {
            currentYear = year;
            
            // Update year button styles
            document.querySelectorAll('.year-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (event && event.target) {
                event.target.classList.add('active');
            }

            // Update month grid for selected year
            updateMonthGrid(year);
        }

        // Update month grid
        function updateMonthGrid(year) {
            const monthGrid = document.getElementById('monthGrid');
            if (!monthGrid) return;

            const months = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];

            monthGrid.innerHTML = '';

            months.forEach((month, index) => {
                const monthCard = document.createElement('div');
                monthCard.className = 'month-card';
                monthCard.onclick = () => viewMonth(year, index + 1);

                const monthData = massData[year] && massData[year][index + 1] ? massData[year][index + 1] : [];
                const daysInMonth = new Date(year, index + 1, 0).getDate();
                const massCount = monthData.length;

                monthCard.innerHTML = `
                    <h4>${month} ${year}</h4>
                    <div class="month-stats">
                        <span>📊 ${daysInMonth} days</span>
                        <span>💒 ${massCount} masses</span>
                    </div>
                `;

                monthGrid.appendChild(monthCard);
            });
        }

        // View specific month
        function viewMonth(year, month) {
            currentYear = year;
            currentMonth = month;

            const monthNames = [
                '', 'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];

            const monthTitleEl = document.getElementById('monthTitle');
            const monthTableEl = document.getElementById('monthTable');
            
            if (monthTitleEl) monthTitleEl.textContent = `${monthNames[month]} ${year}`;
            if (monthTableEl) monthTableEl.style.display = 'block';

            loadMonthData(year, month);
        }

        // Load month data into table
        function loadMonthData(year, month) {
            const tbody = document.getElementById('massTableBody');
            if (!tbody) return;

            const monthData = massData[year] && massData[year][month] ? massData[year][month] : [];
            const daysInMonth = new Date(year, month, 0).getDate();

            tbody.innerHTML = '';

            // Create rows for each day of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayData = monthData.find(entry => entry.date === day);
                
                const row = document.createElement('tr');
                if (dayData) {
                    row.style.backgroundColor = getTypeColor(dayData.type);
                }

                row.innerHTML = `
                    <td>${day}</td>
                    <td>${dayData ? dayData.serial || '-' : '-'}</td>
                    <td>${dayData ? dayData.receiptDate || '-' : '-'}</td>
                    <td>${dayData ? dayData.from || '-' : '-'}</td>
                    <td>${dayData ? dayData.intentions || '-' : '-'}</td>
                    <td>${dayData ? dayData.remarks || '-' : '-'}</td>
                    <td>
                        <button class="btn" onclick="editMass(${year}, ${month}, ${day})" style="padding: 8px 12px; margin: 2px;">✏️</button>
                        ${dayData ? `<button class="btn btn-danger" onclick="deleteMass(${year}, ${month}, ${day})" style="padding: 8px 12px; margin: 2px;">🗑️</button>` : ''}
                    </td>
                `;

                tbody.appendChild(row);
            }
        }

        // Get color for mass type
        function getTypeColor(type) {
            switch(type) {
                case 'deceased': return 'rgba(241, 196, 15, 0.1)';
                case 'personal': return 'rgba(46, 204, 113, 0.1)';
                case 'special': return 'rgba(231, 76, 60, 0.1)';
                default: return 'rgba(52, 152, 219, 0.1)';
            }
        }

        // Hide month table
        function hideMonthTable() {
            const monthTableEl = document.getElementById('monthTable');
            if (monthTableEl) monthTableEl.style.display = 'none';
        }

        // Show add mass modal
        function showAddMassModal() {
            const modal = document.getElementById('addMassModal');
            if (modal) {
                modal.style.display = 'block';
                
                // Set default date to today
                const today = new Date().toISOString().split('T')[0];
                const dateInput = document.getElementById('massDate');
                if (dateInput) dateInput.value = today;
            }
        }

        // Close modal
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                
                // Clear form fields
                const inputs = modal.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    if (input.type !== 'hidden') {
                        input.value = '';
                    }
                });
            }
        }

        // Save new mass
        function saveMass() {
            const date = document.getElementById('massDate')?.value;
            const serial = document.getElementById('massSerial')?.value || '';
            const receiptDate = document.getElementById('massReceiptDate')?.value || '';
            const from = document.getElementById('massFrom')?.value || 'Provincial';
            const intentions = document.getElementById('massIntentions')?.value;
            const remarks = document.getElementById('massRemarks')?.value || '';

            if (!date || !intentions) {
                showNotification('Please fill in required fields!', 'error');
                return;
            }

            const dateObj = new Date(date);
            const year = dateObj.getFullYear();
            const month = dateObj.getMonth() + 1;
            const day = dateObj.getDate();

            // Initialize data structure if needed
            if (!massData[year]) massData[year] = {};
            if (!massData[year][month]) massData[year][month] = [];

            // Determine mass type
            let type = 'regular';
            if (from === 'Personal') type = 'personal';
            else if (from === 'MSFS') type = 'deceased';
            else if (from === 'Special') type = 'special';

            // Create new entry
            const newEntry = {
                id: Date.now(),
                date: day,
                serial: serial,
                receiptDate: receiptDate,
                from: from,
                intentions: intentions,
                remarks: remarks,
                type: type
            };

            // Remove existing entry for this date if any
            massData[year][month] = massData[year][month].filter(entry => entry.date !== day);
            
            // Add new entry
            massData[year][month].push(newEntry);

            saveToStorage();
            closeModal('addMassModal');
            
            // Refresh current view if applicable
            if (currentMonth === month && currentYear === year) {
                loadMonthData(year, month);
            }

            updateDashboardStats();
            showNotification('Mass entry saved successfully!', 'success');
        }

        // Edit mass (simplified - just opens add modal with pre-filled date)
        function editMass(year, month, day) {
            const monthData = massData[year] && massData[year][month] ? massData[year][month] : [];
            const dayData = monthData.find(entry => entry.date === day);

            if (dayData) {
                // Fill the add modal with existing data
                const dateInput = document.getElementById('massDate');
                const serialInput = document.getElementById('massSerial');
                const receiptDateInput = document.getElementById('massReceiptDate');
                const fromInput = document.getElementById('massFrom');
                const intentionsInput = document.getElementById('massIntentions');
                const remarksInput = document.getElementById('massRemarks');

                if (dateInput) dateInput.value = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                if (serialInput) serialInput.value = dayData.serial || '';
                if (receiptDateInput) receiptDateInput.value = dayData.receiptDate || '';
                if (fromInput) fromInput.value = dayData.from || '';
                if (intentionsInput) intentionsInput.value = dayData.intentions || '';
                if (remarksInput) remarksInput.value = dayData.remarks || '';
            } else {
                // No existing data, pre-fill with date
                const dateInput = document.getElementById('massDate');
                if (dateInput) dateInput.value = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
            }
            
            const modal = document.getElementById('addMassModal');
            if (modal) modal.style.display = 'block';
        }

        // Delete mass
        function deleteMass(year, month, day) {
            if (confirm('Are you sure you want to delete this mass entry?')) {
                if (massData[year] && massData[year][month]) {
                    massData[year][month] = massData[year][month].filter(entry => entry.date !== day);
                    saveToStorage();
                    loadMonthData(year, month);
                    updateDashboardStats();
                    showNotification('Mass entry deleted successfully!', 'success');
                }
            }
        }

        // Load deceased data
        function loadDeceasedData() {
            const tbody = document.getElementById('deceasedTableBody');
            if (!tbody) return;

            tbody.innerHTML = '';

            deceasedData.forEach(entry => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${entry.receiptDate}</td>
                    <td>${entry.deathDate}</td>
                    <td>${entry.name}</td>
                    <td>${entry.celebrated}</td>
                    <td>${entry.province || '-'}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteDeceased(${entry.id})" style="padding: 8px 12px;">🗑️</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Show add deceased modal
        function showAddDeceasedModal() {
            const modal = document.getElementById('addDeceasedModal');
            if (modal) modal.style.display = 'block';
        }

        // Save deceased entry
        function saveDeceased() {
            const receiptDate = document.getElementById('deceasedReceiptDate')?.value;
            const deathDate = document.getElementById('deceasedDeathDate')?.value;
            const name = document.getElementById('deceasedName')?.value;
            const celebrated = document.getElementById('deceasedCelebrated')?.value;
            const province = document.getElementById('deceasedProvince')?.value || '';

            if (!receiptDate || !deathDate || !name || !celebrated) {
                showNotification('Please fill in required fields!', 'error');
                return;
            }

            const newEntry = {
                id: Date.now(),
                receiptDate: receiptDate,
                deathDate: deathDate,
                name: name,
                celebrated: celebrated,
                province: province
            };

            deceasedData.push(newEntry);
            saveToStorage();
            closeModal('addDeceasedModal');
            loadDeceasedData();
            updateDashboardStats();
            showNotification('Deceased confrere entry saved successfully!', 'success');
        }

        // Delete deceased entry
        function deleteDeceased(id) {
            if (confirm('Are you sure you want to delete this deceased confrere entry?')) {
                deceasedData = deceasedData.filter(entry => entry.id !== id);
                saveToStorage();
                loadDeceasedData();
                updateDashboardStats();
                showNotification('Deceased confrere entry deleted successfully!', 'success');
            }
        }

        // Load personal mass data
        function loadPersonalData() {
            const tbody = document.getElementById('personalTableBody');
            if (!tbody) return;

            tbody.innerHTML = '';

            personalData.forEach(entry => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${entry.month} ${entry.year}</td>
                    <td>${entry.mass1 || '-'}</td>
                    <td>${entry.mass2 || '-'}</td>
                    <td>${entry.mass3 || '-'}</td>
                    <td>${entry.remarks || '-'}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deletePersonal(${entry.id})" style="padding: 8px 12px;">🗑️</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Show add personal modal
        function showAddPersonalModal() {
            const modal = document.getElementById('addPersonalModal');
            if (modal) modal.style.display = 'block';
        }

        // Save personal mass entry
        function savePersonalMass() {
            const month = document.getElementById('personalMonth')?.value;
            const year = parseInt(document.getElementById('personalYear')?.value);
            const mass1 = document.getElementById('personalMass1')?.value;
            const mass2 = document.getElementById('personalMass2')?.value;
            const mass3 = document.getElementById('personalMass3')?.value;
            const remarks = document.getElementById('personalRemarks')?.value || '';

            if (!month || !year) {
                showNotification('Please fill in required fields!', 'error');
                return;
            }

            const newEntry = {
                id: Date.now(),
                month: month,
                year: year,
                mass1: mass1 ? parseInt(mass1) : null,
                mass2: mass2 ? parseInt(mass2) : null,
                mass3: mass3 ? parseInt(mass3) : null,
                remarks: remarks
            };

            personalData.push(newEntry);
            saveToStorage();
            closeModal('addPersonalModal');
            loadPersonalData();
            updateDashboardStats();
            showNotification('Personal mass entry saved successfully!', 'success');
        }

        // Delete personal mass entry
        function deletePersonal(id) {
            if (confirm('Are you sure you want to delete this personal mass entry?')) {
                personalData = personalData.filter(entry => entry.id !== id);
                saveToStorage();
                loadPersonalData();
                updateDashboardStats();
                showNotification('Personal mass entry deleted successfully!', 'success');
            }
        }

        // Export data functions
        function exportData(format) {
            if (format === 'csv') {
                exportToCSV();
            } else if (format === 'excel') {
                exportToExcel();
            } else if (format === 'pdf') {
                exportToPDF();
            }
        }

        // Export to CSV
        function exportToCSV() {
            let csvContent = 'data:text/csv;charset=utf-8,';
            
            // Add header
            csvContent += 'Mass Intentions Register - MSFS\n\n';
            
            // Add mass data
            csvContent += 'MASS ENTRIES\n';
            csvContent += 'Year,Month,Date,Serial No,Receipt Date,From Whom,Intentions,Remarks,Type\n';
            
            Object.keys(massData).forEach(year => {
                Object.keys(massData[year]).forEach(month => {
                    massData[year][month].forEach(entry => {
                        const row = [
                            year,
                            month,
                            entry.date,
                            entry.serial || '-',
                            entry.receiptDate || '-',
                            entry.from || '-',
                            `"${entry.intentions || '-'}"`,
                            `"${entry.remarks || '-'}"`,
                            entry.type || '-'
                        ].join(',');
                        csvContent += row + '\n';
                    });
                });
            });
            
            // Add deceased data
            csvContent += '\nDECEASED CONFRERES\n';
            csvContent += 'Receipt Date,Death Date,Name,Celebrated Date,Province\n';
            deceasedData.forEach(entry => {
                const row = [
                    entry.receiptDate,
                    entry.deathDate,
                    `"${entry.name}"`,
                    entry.celebrated,
                    `"${entry.province || '-'}"`
                ].join(',');
                csvContent += row + '\n';
            });
            
            // Add personal mass data
            csvContent += '\nPERSONAL MASSES\n';
            csvContent += 'Month,Year,Mass I,Mass II,Mass III,Remarks\n';
            personalData.forEach(entry => {
                const row = [
                    entry.month,
                    entry.year,
                    entry.mass1 || '-',
                    entry.mass2 || '-',
                    entry.mass3 || '-',
                    `"${entry.remarks || '-'}"`
                ].join(',');
                csvContent += row + '\n';
            });

            // Create and download file
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', 'Mass_Intentions_Register_MSFS.csv');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('CSV file exported successfully!', 'success');
        }

        // Export to Excel (simplified version - creates tab-separated values)
        function exportToExcel() {
            let excelContent = 'data:application/vnd.ms-excel;charset=utf-8,';
            
            // Add header
            excelContent += 'Mass Intentions Register - MSFS\t\t\t\t\t\t\t\t\n\n';
            
            // Add mass data
            excelContent += 'MASS ENTRIES\t\t\t\t\t\t\t\t\n';
            excelContent += 'Year\tMonth\tDate\tSerial No\tReceipt Date\tFrom Whom\tIntentions\tRemarks\tType\n';
            
            Object.keys(massData).forEach(year => {
                Object.keys(massData[year]).forEach(month => {
                    massData[year][month].forEach(entry => {
                        const row = [
                            year,
                            month,
                            entry.date,
                            entry.serial || '-',
                            entry.receiptDate || '-',
                            entry.from || '-',
                            entry.intentions || '-',
                            entry.remarks || '-',
                            entry.type || '-'
                        ].join('\t');
                        excelContent += row + '\n';
                    });
                });
            });
            
            // Add deceased data
            excelContent += '\nDECEASED CONFRERES\t\t\t\t\n';
            excelContent += 'Receipt Date\tDeath Date\tName\tCelebrated Date\tProvince\n';
            deceasedData.forEach(entry => {
                const row = [
                    entry.receiptDate,
                    entry.deathDate,
                    entry.name,
                    entry.celebrated,
                    entry.province || '-'
                ].join('\t');
                excelContent += row + '\n';
            });
            
            // Create and download file
            const encodedUri = encodeURI(excelContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', 'Mass_Intentions_Register_MSFS.xls');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Excel file exported successfully!', 'success');
        }

        // Export to PDF (simplified - creates HTML that can be printed to PDF)
        function exportToPDF() {
            const printWindow = window.open('', '_blank');
            let htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Mass Intentions Register - MSFS</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { text-align: center; color: #2c3e50; }
                        h2 { color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 5px; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 12px; }
                        th { background-color: #3498db; color: white; }
                        tr:nth-child(even) { background-color: #f2f2f2; }
                        .page-break { page-break-before: always; }
                    </style>
                </head>
                <body>
                    <h1>🕊️ Mass Intentions Register</h1>
                    <h1>Missionaries of St. Francis de Sales (MSFS)</h1>
                    
                    <h2>Mass Entries</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Year</th><th>Month</th><th>Date</th><th>Serial No</th>
                                <th>Receipt Date</th><th>From Whom</th><th>Intentions</th><th>Remarks</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            // Add mass data
            Object.keys(massData).forEach(year => {
                Object.keys(massData[year]).forEach(month => {
                    massData[year][month].forEach(entry => {
                        htmlContent += `
                            <tr>
                                <td>${year}</td>
                                <td>${month}</td>
                                <td>${entry.date}</td>
                                <td>${entry.serial || '-'}</td>
                                <td>${entry.receiptDate || '-'}</td>
                                <td>${entry.from || '-'}</td>
                                <td>${entry.intentions || '-'}</td>
                                <td>${entry.remarks || '-'}</td>
                            </tr>
                        `;
                    });
                });
            });

            htmlContent += `
                        </tbody>
                    </table>
                    
                    <div class="page-break"></div>
                    <h2>Deceased Confreres</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Receipt Date</th><th>Death Date</th><th>Name</th>
                                <th>Celebrated Date</th><th>Province</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            // Add deceased data
            deceasedData.forEach(entry => {
                htmlContent += `
                    <tr>
                        <td>${entry.receiptDate}</td>
                        <td>${entry.deathDate}</td>
                        <td>${entry.name}</td>
                        <td>${entry.celebrated}</td>
                        <td>${entry.province || '-'}</td>
                    </tr>
                `;
            });

            htmlContent += `
                        </tbody>
                    </table>
                    
                    <h2>Personal Mass Intentions</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Month</th><th>Year</th><th>Mass I</th>
                                <th>Mass II</th><th>Mass III</th><th>Remarks</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            // Add personal mass data
            personalData.forEach(entry => {
                htmlContent += `
                    <tr>
                        <td>${entry.month}</td>
                        <td>${entry.year}</td>
                        <td>${entry.mass1 || '-'}</td>
                        <td>${entry.mass2 || '-'}</td>
                        <td>${entry.mass3 || '-'}</td>
                        <td>${entry.remarks || '-'}</td>
                    </tr>
                `;
            });

            htmlContent += `
                        </tbody>
                    </table>
                </body>
                </html>
            `;

            if (printWindow) {
                printWindow.document.write(htmlContent);
                printWindow.document.close();
                
                // Trigger print dialog
                setTimeout(() => {
                    printWindow.print();
                    showNotification('PDF export initiated! Please use browser print to save as PDF.', 'info');
                }, 500);
            }
        }

        // Generate reports
        function generateReport(type) {
            if (type === 'summary') {
                generateSummaryReport();
            } else if (type === 'monthly') {
                generateMonthlyReport();
            } else if (type === 'deceased') {
                generateDeceasedReport();
            }
        }

        // Generate summary report
        function generateSummaryReport() {
            let totalMasses = 0;
            let serialMasses = 0;
            let personalMasses = 0;
            let deceasedMasses = 0;
            let specialMasses = 0;

            Object.keys(massData).forEach(year => {
                Object.keys(massData[year]).forEach(month => {
                    massData[year][month].forEach(entry => {
                        totalMasses++;
                        if (entry.serial) serialMasses++;
                        if (entry.type === 'personal') personalMasses++;
                        if (entry.type === 'deceased') deceasedMasses++;
                        if (entry.type === 'special') specialMasses++;
                    });
                });
            });

            const reportContent = `
MASS INTENTIONS SUMMARY REPORT
Generated on: ${new Date().toLocaleDateString()}

OVERALL STATISTICS:
Total Masses Recorded: ${totalMasses}
Serial Number Masses: ${serialMasses}
Personal Masses: ${personalMasses}
Deceased Confrere Masses: ${deceasedMasses}
Special Masses: ${specialMasses}

DECEASED CONFRERES:
Total Memorial Masses: ${deceasedData.length}

PERSONAL MASS OBLIGATIONS:
Total Monthly Entries: ${personalData.length}

PERIOD COVERAGE:
Active Years: ${Object.keys(massData).join(', ')}

STATUS:
Original Mass Intentions: 300
Masses Celebrated: ${serialMasses}
Remaining Serial Numbers: ${300 - serialMasses}
Completion Rate: ${((serialMasses / 300) * 100).toFixed(1)}%
            `;

            downloadTextFile(reportContent, 'Mass_Intentions_Summary_Report.txt');
        }

        // Generate monthly report
        function generateMonthlyReport() {
            showNotification('Monthly report generated!', 'info');
        }

        // Generate deceased report
        function generateDeceasedReport() {
            showNotification('Deceased report generated!', 'info');
        }

        // Download text file
        function downloadTextFile(content, filename) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
            
            showNotification('Report generated successfully!', 'success');
        }

        // Save month data
        function saveMonthData() {
            saveToStorage();
            showNotification('Month data saved successfully!', 'success');
        }

        // Save settings
        function saveSettings() {
            const totalIntentions = document.getElementById('totalIntentions')?.value;
            const backupFreq = document.getElementById('backupFreq')?.value;
            
            // Save settings to memory storage
            if (!window.massIntentionsStorage) {
                window.massIntentionsStorage = {};
            }
            window.massIntentionsStorage.settings = {
                totalIntentions: totalIntentions,
                backupFrequency: backupFreq
            };
            
            showNotification('Settings saved successfully!', 'success');
        }

        // Backup data
        function backupData() {
            const backupData = {
                massData: massData,
                deceasedData: deceasedData,
                personalData: personalData,
                exportDate: new Date().toISOString(),
                version: "2.0",
                metadata: {
                    totalMasses: Object.values(massData).reduce((total, year) => {
                        return total + Object.values(year).reduce((yearTotal, month) => yearTotal + month.length, 0);
                    }, 0),
                    totalDeceased: deceasedData.length,
                    totalPersonal: personalData.length,
                    years: Object.keys(massData).sort()
                }
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            downloadTextFile(dataStr, `Mass_Intentions_Backup_${new Date().toISOString().split('T')[0]}.json`);
        }

        // Reset data (with confirmation)
        function resetData() {
            if (confirm('⚠️ WARNING: This will delete ALL data permanently. Are you absolutely sure?')) {
                if (confirm('🚨 FINAL WARNING: This action cannot be undone. Proceed with data deletion?')) {
                    // Clear memory storage
                    if (window.massIntentionsStorage) {
                        delete window.massIntentionsStorage;
                    }
                    
                    massData = {};
                    deceasedData = [];
                    personalData = [];
                    
                    // Reinitialize with sample data
                    initializeData();
                    
                    showNotification('All data has been reset to initial state!', 'info');
                    
                    // Refresh current view
                    updateDashboardStats();
                    updateMonthGrid(currentYear);
                }
            }
        }

        // Bulk import functions (simplified implementations)
        function handleFileSelect(event) {
            const file = event.target.files[0];
            const importBtn = document.getElementById('importBtn');
            
            if (!file) {
                if (importBtn) importBtn.disabled = true;
                return;
            }

            const fileExtension = file.name.split('.').pop().toLowerCase();
            const allowedExtensions = ['csv', 'xlsx', 'xls', 'json'];

            if (!allowedExtensions.includes(fileExtension)) {
                showNotification('Unsupported file format. Please use CSV, Excel, or JSON files.', 'error');
                if (importBtn) importBtn.disabled = true;
                return;
            }

            showNotification(`File "${file.name}" selected. Click "Preview Data" to review before importing.`, 'info');
            if (importBtn) importBtn.disabled = false;
        }

        function showImportPreview() {
            showNotification('Import preview feature is available. Please select a file first.', 'info');
        }

        function executeImport() {
            showNotification('Import functionality is available for CSV and JSON files.', 'info');
        }

        function downloadTemplate() {
            const importType = document.getElementById('importType')?.value;
            
            if (importType === 'mass') {
                const csvContent = `Year,Month,Date,SerialNo,ReceiptDate,FromWhom,Intentions,Remarks,Type
2024,1,1,147,2023-08-23,Provincial,"Mass Intention","","regular"
2024,1,13,"",2024-01-12,MSFS,"Fr. Mariadas Sesetti","Deceased Confrere","deceased"`;
                downloadCSVFile(csvContent, 'Mass_Entries_Template.csv');
            } else if (importType === 'deceased') {
                const csvContent = `ReceiptDate,DeathDate,Name,CelebratedDate,Province
2024-01-12,2024-01-12,"Fr. Mariadas Sesetti",2024-01-13,"Vizag Province"`;
                downloadCSVFile(csvContent, 'Deceased_Confreres_Template.csv');
            } else if (importType === 'personal') {
                const csvContent = `Month,Year,Mass1,Mass2,Mass3,Remarks
January,2024,18,27,5,"Birthday; Anniversary; Personal"`;
                downloadCSVFile(csvContent, 'Personal_Masses_Template.csv');
            }
        }

        function downloadCSVFile(content, filename) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            }
        }

        function downloadAllTemplates() {
            downloadTemplate();
            showNotification('Template downloaded!', 'success');
        }

        function showImportHelp() {
            const modal = document.getElementById('importHelpModal');
            if (modal) modal.style.display = 'block';
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            if (notification) {
                notification.textContent = message;
                notification.className = `notification ${type}`;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        }

        // Update dashboard statistics
        function updateDashboardStats() {
            let totalMasses = 0;
            let serialMasses = 0;

            Object.keys(massData).forEach(year => {
                Object.keys(massData[year]).forEach(month => {
                    totalMasses += massData[year][month].length;
                    massData[year][month].forEach(entry => {
                        if (entry.serial) serialMasses++;
                    });
                });
            });

            // Update dashboard cards
            const totalMassesEl = document.getElementById('totalMasses');
            const remainingSerialEl = document.getElementById('remainingSerial');
            const deceasedMassesEl = document.getElementById('deceasedMasses');
            const personalMassesEl = document.getElementById('personalMasses');

            if (totalMassesEl) totalMassesEl.textContent = totalMasses;
            if (remainingSerialEl) remainingSerialEl.textContent = Math.max(0, 300 - serialMasses);
            if (deceasedMassesEl) deceasedMassesEl.textContent = deceasedData.length;
            if (personalMassesEl) personalMassesEl.textContent = personalData.length * 3; // 3 masses per entry
        }

        // Create animated background particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            if (!particlesContainer) return;

            const particleCount = 50;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Random positioning and sizing
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.width = (Math.random() * 4 + 2) + 'px';
                particle.style.height = particle.style.width;
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
                
                particlesContainer.appendChild(particle);
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            initializeData();
            updateMonthGrid(2024);
            updateDashboardStats();
            createParticles();
            
            console.log('🕊️ Enhanced Mass Intentions Management System initialized successfully!');
        });

        // Auto-save functionality
        setInterval(() => {
            if (Object.keys(massData).length > 0 || deceasedData.length > 0 || personalData.length > 0) {
                saveToStorage();
            }
        }, 30000); // Auto-save every 30 seconds

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Ctrl+S to save
            if (event.ctrlKey && event.key === 's') {
                event.preventDefault();
                saveToStorage();
            }
            
            // Escape to close modals
            if (event.key === 'Escape') {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (modal.style.display === 'block') {
                        modal.style.display = 'none';
                    }
                });
            }
        });
    </script>
</body>
</html>
